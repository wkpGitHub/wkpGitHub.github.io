(function(){"use strict";var t={4080:function(t,e,n){var o=n(9242),i=n(3396),r=n(7139);const s={class:"el-scrollbar__view el-select-dropdown__list",style:{}},a={class:"el-select-dropdown__item"},l=(0,i._)("span",{class:"demonstration"},"选择颜色",-1),d={class:"demonstration"},c={class:"demonstration"};function h(t,e,n,h,u,p){const y=(0,i.up)("el-color-picker");return(0,i.wg)(),(0,i.iD)(i.HY,null,[(0,i._)("div",{id:"force",style:{width:"100vw",height:"100vh"},onClick:e[0]||(e[0]=t=>u.menu.isShow=!1)}),(0,i.wy)((0,i._)("div",{class:"el-select-dropdown__wrap el-scrollbar__wrap el-scrollbar__wrap--hidden-default",style:(0,r.j5)({left:u.menu.x,top:u.menu.y})},[(0,i._)("ul",s,[(0,i._)("li",a,[l,(0,i.Wm)(y,{value:u.color,onChange:p.changeColor},null,8,["value","onChange"])]),(0,i._)("li",{class:"el-select-dropdown__item",onClick:e[1]||(e[1]=(...t)=>p.hiddenChildren&&p.hiddenChildren(...t))},[(0,i._)("span",d,(0,r.zw)(u.d.hiddenChildren?"展开所有子节点":"收起所有子节点"),1)]),(0,i._)("li",{class:"el-select-dropdown__item",onClick:e[2]||(e[2]=(...t)=>p.switchShowLink&&p.switchShowLink(...t))},[(0,i._)("span",c,(0,r.zw)(u.d.toShowOnly?"显示所有节点":"只显示当前关联节点"),1)])])],4),[[o.F8,u.menu.isShow]])],64)}n(7658);var u=n(3381),p=n(5254),y=n.n(p);function f(t,e){let n=!0,o=null;return function(...i){n&&(n=!1,t.apply(this,i),setTimeout((()=>{n=!0}),e)),clearTimeout(o),o=setTimeout((()=>{t.apply(this,i)}),e)}}const m=f(((t,e)=>{var n=[],o=t.map((t=>t.textCoors)),i=o.sort(((t,e)=>t.x0-e.x0))[0].x0,r=o.sort(((t,e)=>e.x1-t.x1))[0].x1,s=o.sort(((t,e)=>t.y0-e.y0))[0].y0,a=o.sort(((t,e)=>e.y1-t.y1))[0].y1,l=new(y())({x:i,y:s,width:r-i,height:a-s});t.forEach((t=>{t.textOpacity=!1;const{textCoors:e,id:n}=t;l.insert({x:e.x0,y:e.y0,width:e.x1-e.x0,height:e.y1-e.y0,node:t})})),t.forEach((t=>{const{textCoors:e,id:o}=t;n.push(o);const i=l.retrieve({x:e.x0,y:e.y0,width:e.x1-e.x0,height:e.y1-e.y0});i.forEach((e=>{t.id!==e.node.id&&g(t,e.node,n)}))})),e.select(".node-text").attr("fill-opacity",(t=>{if(t.animation)return 1;{const e=t.hasOwnProperty("textDark")&&!1===t.textDark;return t.textOpacity&&!e?.2:1}}))}),800);function g(t,e,n){const o=t.textCoors.x0,i=t.textCoors.y0,r=t.textCoors.x1,s=t.textCoors.y1,a=e.textCoors.x0,l=e.textCoors.y0,d=e.textCoors.x1,c=e.textCoors.y1,h=t.nodeTextWidth+e.nodeTextWidth,u=32,p=Math.max(o,r,a,d)-Math.min(o,r,a,d),y=Math.max(i,s,l,c)-Math.min(i,s,l,c);p<h&&y<u&&n.includes(e.id)&&(e.textOpacity=!0)}class x{constructor({el:t,data:e,node:n,link:o}){this.$el=(0,u.Ys)(t),this._data=e,this._node=Object.assign({key:"id"},n),this._link=Object.assign({key:"id"},o),this.transform=u.CRH.scale(1.2),this.initDom(),this.initEvent(),this.setData(e)}nodeProperty(t){const{h:e,s:n,l:o,opacity:i}=(0,u.Ym7)(t?.color||"#00fff0");return{r:10,isDraw:!0,hidden:!1,opacity:1,showOnly:!1,color:{innerFill:(0,u.Ym7)(e,n,.7*o,i).rgb().toString(),innerStroke:"#00fff0",outerFill:(0,u.Ym7)(e,n,.3*o,i).rgb().toString(),outerStroke:(0,u.Ym7)(e,n,.7*o,i).rgb().toString()},id:this.getId(),path:"M6.123233995736766e-16,-10A10,10,0,1,1,-6.123233995736766e-16,10A10,10,0,1,1,6.123233995736766e-16,-10Z"}}getLinkProperty(){return{isDraw:!0,showOnly:!1,hidden:!1,opacity:.1,id:this.getId(),markEnd:"url(#arrow-marker-end)",animation:!1}}initEvent(){let t=!0;this.$el.on("contextmenu",(function(){u.Ba6.preventDefault()}),!0);const e=new ResizeObserver((()=>this.resize((()=>{if(t)return t=!1,!1;this.getDrawElement()}))));e.observe(this.$el.node())}resize(t){this.w=this.$el.node().clientWidth,this.h=this.$el.node().clientHeight,this.svg.attr("width",this.w).attr("height",this.h),t?.()}setData(t){let e=this.node?.data||[],n=this.link?.data||[];if(t){var o=(0,u.bT9)(t);e=o.descendants(),n=o.links()}this.initData(e,n)}initData(t,e){this.nodes=t.map((t=>{const e=this.nodeProperty();return Object.keys(e).forEach((n=>{Object.prototype.hasOwnProperty.call(t,n)||(t[n]=e[n])})),t})),this.links=e.map((t=>{const e=this.getLinkProperty();return Object.keys(e).forEach((n=>{Object.prototype.hasOwnProperty.call(t,n)||(t[n]=e[n])})),t.relation=t.target.data.name,t})),this.simulation=(0,u.A4v)(this.nodes).alphaDecay(.06).velocityDecay(.3),this.simulation.force("center",(0,u.wqt)(this.w/2,this.h/2)),this.simulation.force("manbody",(0,u.q5i)().strength(-100)),this.simulation.force("link",(0,u.Fsl)(this.links).distance(50)),this.simulation.force("collide",(0,u.Hh)(20));let n=0;const o=()=>{n++,n<80?(n>4&&this.getDrawElement(),requestAnimationFrame(o)):(this.simulation.stop(),this.nodes.forEach((t=>{t.vx=0,t.vy=0})))};o()}initDom(){var t=(0,u.sPX)().scaleExtent([.6,4]).on("zoom",(()=>{this.transform=u.Ba6.transform,this.container.attr("transform",this.transform),this.getDrawElement()}));this.svg=this.$el.append("svg").style("background-color","#06101d").style("display","block").call(t),this.resize(),this.container=this.svg.append("g"),this.svg.call(t.transform,this.transform),this.gLinks=this.container.append("g").classed("links",!0),this.gNodes=this.container.append("g").classed("nodes",!0),this.svg.append("defs").append("marker").attr("id","arrow-marker-end").attr("markerWidth",8).attr("markerHeight",8).attr("refX",5).attr("refY",4).attr("viewBox","0 0 8 8").attr("fill","#fff").attr("orient","auto").append("path").attr("d","M1,1L7,4L1,7z")}getDrawElement(){var t={x0:-250,y0:-250,x1:this.w+250,y1:this.h+250};this.nodes?.length&&(this.nodes.forEach((e=>{const n=this.transform.applyX(e.x),o=this.transform.applyY(e.y);e.isDraw=n>t.x0&&n<t.x1&&o>t.y0&&o<t.y1})),this.links.forEach((t=>{const{source:e,target:n}=t;t.isDraw=e.isDraw||n.isDraw})),this.updateLinks(),this.updateNodes())}updateNodes(){const t=this;var e=this.gNodes.selectAll("g.g-circle").data(this.nodes.filter((t=>!t.hidden&&t.isDraw&&!t.showOnly)),(t=>t[this._node.key])),n=e.enter().append("g").classed("g-circle",!0);n.append("path").classed("out-circle",!0),n.append("path").classed("inner-circle",!0),n.append("text").classed("node-text",!0).attr("dy",4).text((t=>t.data.name));var o=e.merge(n).attr("opacity",(t=>t.opacity)).attr("transform",(t=>`translate(${t.x},${t.y})`)).on("mouseenter",(function(e){const n=e.ancestors().map((e=>e[t._node.key]));if(e.id!==n[n.length-1]){const i=e.descendants().map((e=>e[t._node.key])),r=i.concat(n);t.nodes.forEach((e=>{e.animation=!0,e.opacity=r.includes(e[t._node.key])?1:.1}));const s=[];for(var o=n.length-1;o>0;o--)s.push({source:{id:n[o]},target:{id:n[o-1]}});const a=e.links().concat(s).map((({source:t,target:e})=>t.id+"-"+e.id));t.links.forEach((t=>{const{source:e,target:n}=t;a.includes(e.id+"-"+n.id)&&(t.opacity=.8,t.animation=!0)}))}(0,u.Ys)(this).append("path").classed("link-circle",!0).attr("id","selectPath").attr("d",(t=>t.path)).on("mousedown",(e=>{u.Ba6.stopPropagation();let n=t.transform.applyX(e.x),o=t.transform.applyY(e.y);t.drawLine({startx:n,starty:o,source:e})})),t.updateNodes(),t.updateLinks()})).on("mouseleave",(function(e){(0,u.Ys)("#selectPath").remove(),t.nodes.forEach((t=>{t.opacity=1,t.animation=!1})),t.links.forEach((t=>{t.opacity=.1,t.animation=!1})),t.updateNodes(),t.updateLinks()})).on("click",(e=>{this._node.onClick?.(u.Ba6,e,t),this.spread(e)})).on("dblclick",(function(t){u.Ba6.stopPropagation()})).on("contextmenu",(t=>this._node.onContextmenu?.(u.Ba6,t,this))).call(this.bindDrag());o.select(".out-circle").attr("fill",(t=>t.color.outerFill)).attr("d",(t=>t.path)).attr("stroke",(t=>t.color.outerStroke)),o.select(".inner-circle").attr("fill",(t=>t.color.innerFill)).attr("d",(t=>t.path)).attr("stroke",(t=>t.color.innerStroke)),o.select(".node-text").attr("dx",(t=>t.r+5)).attr("fill",(t=>t.color.innerFill)).attr("width",(function(e){e.nodeTextWidth=this.getComputedTextLength(),t.setTextCoors(e)})),m(this.nodes.filter((t=>!t.hidden&&t.isDraw&&!t.showOnly)),o),e.exit().remove()}updateLinks(){const t=this;var e=this.gLinks.selectAll("g.link").data(this.links.filter((t=>!t.hidden&&t.isDraw&&!t.showOnly)),(t=>t[this._link.key])),n=e.enter().append("g").classed("link",!0);n.append("path").classed("link-path",!0);var o=n.append("g").classed("gtext",!0);o.append("text").classed("link-text",!0).text((t=>t.relation)).attr("dy",3).attr("width",(function(t){t.textWidth=this.getComputedTextLength()+8})),o.insert("rect","text").attr("width",(t=>t.textWidth)).attr("height",16).attr("fill","#06101d").attr("x",(t=>-t.textWidth/2)).attr("y",-8);var i=e.merge(n).attr("opacity",(t=>t.opacity)).on("click",(function(t){console.log(t)})).on("mouseenter",(t=>{t.opacity=.8,t.animation=!0,this.updateLinks()})).on("mouseleave",(t=>{t.opacity=.1,t.animation=!1,this.updateLinks()}));i.select(".link-path").attr("d",(t=>{const{source:e,target:n}=t,{_x:o,_y:i}=this.getCos(e,n,n.r+2);return this.generateLinkPath(e,{x:o,y:i})})).attr("marker-end",(t=>t.markEnd)).classed("link-fade-out",(t=>t.animation)),i.select(".gtext").style("display",(t=>t.animation?"block":"none")).attr("transform",(e=>{if(e.animation){const{source:n,target:o}=e,{_x:i,_y:r}=t.getMiddle(n.x,n.y,(o.x+n.x)/2,n.y,o.x,o.y),s=360*Math.atan((o.y-n.y)/(o.x-n.x))/(2*Math.PI);return`translate(${i},${r}) rotate(${s})`}})),e.exit().remove()}setTextCoors(t){const{x:e,y:n,nodeTextWidth:o}=t;t.textCoors={x0:e+t.r+5,y0:n-8,x1:e+t.r+5+o,y1:n+8}}spread(t){const e=(t.children||[]).filter((t=>!t.children));var n=(0,u.A4v)(e).alphaDecay(.05).stop();n.force("center",(0,u.wqt)(t.x,t.y)),n.force("collide",(0,u.Hh)(40));for(let o=0;o<50;o++)n.tick();this.updateNodes(),this.updateLinks(),n=null}drawLine({startx:t,starty:e,source:n}){const{transform:o,generateLinkPath:i,getCos:r,simulation:s,links:a}=this,l=this,{k:d}=o;var c,h=this.svg.insert("path","g").classed("link-path",!0).attr("marker-end","url(#arrow-marker-end)").attr("transform",`scale(${d})`);function p(a){const l=o.invertX(a.x),u=o.invertY(a.y),p=s.find(l,u,18);if(p){const{_x:s,_y:a}=r(n,p,12);let l=o.applyX(s),u=o.applyY(a);c=p,h.attr("d",i({x:t/d,y:e/d},{x:l/d,y:u/d}))}else c=null,h.attr("d",i({x:t/d,y:e/d},{x:a.x/d,y:a.y/d}))}function y(){if(c){const t=l.getLinkProperty();a.push({...t,target:c,source:n,relation:n.data.name}),l.updateLinks(),s.force("link",(0,u.Fsl)(a).distance(30))}h.remove(),window.removeEventListener("mousemove",p),window.removeEventListener("mouseup",y)}window.addEventListener("mousemove",p),window.addEventListener("mouseup",y)}bindDrag(){const t=this;function e(e){console.log("start");const n=(e.children||[]).filter((t=>!t.children));n.push(e);var o=(0,u.A4v)(n).alphaDecay(.05).stop();e.simulation=o,o.force("manbody",(0,u.q5i)().strength(-100));const i=t.links.filter((({target:t,source:n})=>[t.id,n.id].includes(e.id)));o.force("link",(0,u.Fsl)(i).distance(60)),o.force("collide",(0,u.Hh)(20)),o.on("tick",(()=>{console.log("tick"),t.getDrawElement()})),o.on("end",(()=>{console.log("end"),o=null,e.fx=null,e.fy=null})),e.fx=e.x,e.fy=e.y}function n(t){t.simulation.alphaTarget(.3).restart(),t.fx=u.Ba6.x,t.fy=u.Ba6.y}function o(t){t.simulation.alphaTarget(0)}return(0,u.ohM)().on("start",e).on("drag",n).on("end",o)}generateLinkPath(t,e){var n=(0,u.ETc)();return n.moveTo(t.x,t.y),n.quadraticCurveTo((t.x+e.x)/2,t.y,e.x,e.y),n.toString()}getCos(t,e,n){const o=Math.abs(t.x-e.x),i=Math.abs(t.y-e.y),r=Math.sqrt(o*o+i*i),s=o*n/r||0,a=i*n/r||0;let l,d;return l=t.x>=e.x?e.x+s:e.x-s,d=t.y>=e.y?e.y+a:e.y-a,{_x:l,_y:d}}getMiddle(t,e,n,o,i,r){function s(t,e){const n=Math.abs(t.x-e.x),o=Math.abs(t.y-e.y),i=(Math.sqrt(n*n+o*o),.5*n||0),r=.5*o||0;let s,a;return s=t.x>=e.x?e.x+i:e.x-i,a=t.y>=e.y?e.y+r:e.y-r,{_x:s,_y:a}}const a=s({x:t,y:e},{x:n,y:o}),l=s({x:n,y:o},{x:i,y:r});return s({x:a._x,y:a._y},{x:l._x,y:l._y})}getId(){return Math.random().toString(16).slice(2)+"-"+Math.random().toString(16).slice(6)}}var k={name:"App",data(){return{color:"#00fff0",menu:{isShow:!1,x:0,y:0},d:{}}},methods:{changeColor(t){const{h:e,s:n,l:o,opacity:i}=(0,u.Ym7)(t);var r={innerFill:(0,u.Ym7)(e,n,.7*o,i).rgb().toString(),innerStroke:t,outerFill:(0,u.Ym7)(e,n,.3*o,i).rgb().toString(),outerStroke:(0,u.Ym7)(e,n,.7*o,i).rgb().toString()};this.d.color=r,this.menu.isShow=!1,this.graf.updateNodes(),this.menu.isShow=!1},hiddenChildren(){const{d:t}=this;t.hiddenChildren=!t.hiddenChildren;const e=t.links().map((t=>t.target.id+"__"+t.source.id));this.graf.links.forEach((n=>{e.includes(n.target.id+"__"+n.source.id)&&(n.hidden=t.hiddenChildren)})),t.descendants().forEach((e=>{e.id!==t.id&&(e.hidden=t.hiddenChildren)})),this.graf.updateNodes(),this.graf.updateLinks(),this.menu.isShow=!1},switchShowLink(){const{d:t,graf:e}=this;if(t.toShowOnly)e.nodes.forEach((t=>{t.showOnly=!1,delete t.toShowOnly})),e.links.forEach((t=>{t.showOnly=!1}));else{const o=t.ancestors().map((t=>t[e._node.key]));if(t.id!==o[o.length-1]){const i=t.descendants().map((t=>t[e._node.key])),r=i.concat(o);e.nodes.forEach((t=>{t.showOnly=!r.includes(t[e._node.key]),t.toShowOnly=!0}));const s=[];for(var n=o.length-1;n>0;n--)s.push({source:{id:o[n]},target:{id:o[n-1]}});const a=t.links().concat(s).map((({source:t,target:e})=>t.id+"-"+e.id));e.links.forEach((t=>{const{source:e,target:n}=t;t.showOnly=!a.includes(e.id+"-"+n.id)}))}}e.updateNodes(),e.updateLinks(),this.menu.isShow=!1}},mounted(){var t=this;(0,u.AVB)("./flare.json").then((e=>{let n=sessionStorage.getItem("nodes")||2;this.graf=new x({el:"#force",data:{name:"root",children:Array.from({length:n},(()=>e))},node:{onContextmenu(e,n,o){t.menu={isShow:!0,x:e.x+"px",y:e.y+"px"},t.d=n}}})}));const e=new dat.GUI;e.addColor({"选择颜色":"#00fff0"},"选择颜色").onChange((t=>{const{h:e,s:n,l:o,opacity:i}=(0,u.Ym7)(t);var r={innerFill:(0,u.Ym7)(e,n,.7*o,i).rgb().toString(),innerStroke:t,outerFill:(0,u.Ym7)(e,n,.3*o,i).rgb().toString(),outerStroke:(0,u.Ym7)(e,n,.7*o,i).rgb().toString()};this.graf.nodes.forEach((t=>{t.color=r})),this.graf.updateNodes()})),e.add({"选择图形":"M6.123233995736766e-16,-10A10,10,0,1,1,-6.123233995736766e-16,10A10,10,0,1,1,6.123233995736766e-16,-10Z"},"选择图形",{"圆形":"M6.123233995736766e-16,-10A10,10,0,1,1,-6.123233995736766e-16,10A10,10,0,1,1,6.123233995736766e-16,-10Z","五角星":"M 0,10 L3,4 L9,3.8 L4.8,-1.3 L6,-8 L0,-5 L-6,-8 L-4.8,-1.3 L-9,3.8 L-3,4Z","正方形":"M -7,7 L7,7 L7,-7 L-7,-7Z"}).onChange((t=>{this.graf.nodes.forEach((e=>e.path=t)),this.graf.updateNodes()})),e.add({"选择数据量":sessionStorage.getItem("nodes")||2},"选择数据量",{"500条":2,"1,000条":4,"5,000条":20,"10,000条":40,"20,000条":80,"50,000条":200,"100,000条":400,"200,000条":800,"500,000条":2e3}).onChange((t=>{sessionStorage.setItem("nodes",t),location.reload()}))}},w=n(89);const v=(0,w.Z)(k,[["render",h]]);var _=v,b=n(2002);n(4415);(0,o.ri)(_).use(b.Z).mount("#app")}},e={};function n(o){var i=e[o];if(void 0!==i)return i.exports;var r=e[o]={exports:{}};return t[o].call(r.exports,r,r.exports,n),r.exports}n.m=t,function(){var t=[];n.O=function(e,o,i,r){if(!o){var s=1/0;for(c=0;c<t.length;c++){o=t[c][0],i=t[c][1],r=t[c][2];for(var a=!0,l=0;l<o.length;l++)(!1&r||s>=r)&&Object.keys(n.O).every((function(t){return n.O[t](o[l])}))?o.splice(l--,1):(a=!1,r<s&&(s=r));if(a){t.splice(c--,1);var d=i();void 0!==d&&(e=d)}}return e}r=r||0;for(var c=t.length;c>0&&t[c-1][2]>r;c--)t[c]=t[c-1];t[c]=[o,i,r]}}(),function(){n.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return n.d(e,{a:e}),e}}(),function(){n.d=function(t,e){for(var o in e)n.o(e,o)&&!n.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:e[o]})}}(),function(){n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"===typeof window)return window}}()}(),function(){n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)}}(),function(){var t={143:0};n.O.j=function(e){return 0===t[e]};var e=function(e,o){var i,r,s=o[0],a=o[1],l=o[2],d=0;if(s.some((function(e){return 0!==t[e]}))){for(i in a)n.o(a,i)&&(n.m[i]=a[i]);if(l)var c=l(n)}for(e&&e(o);d<s.length;d++)r=s[d],n.o(t,r)&&t[r]&&t[r][0](),t[r]=0;return n.O(c)},o=self["webpackChunkpixi_demo"]=self["webpackChunkpixi_demo"]||[];o.forEach(e.bind(null,0)),o.push=e.bind(null,o.push.bind(o))}();var o=n.O(void 0,[998],(function(){return n(4080)}));o=n.O(o)})();
//# sourceMappingURL=app.4cef72d3.js.map